<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>AI Visual Pipe Diagnostics - Deteksi Mampet Otomatis|RooterIn - Promo Akhir Pekan: Deteksi Kamera AI Gratis!</title>
<meta name="description" content="Gunakan teknologi AI (Computer Vision) Rooterin untuk mendeteksi masalah pipa Anda hanya dengan foto. Cepat, akurat, dan canggih.">
<link rel="canonical" href="tips.html">
<meta property="og:title" content="AI Visual Pipe Diagnostics - Deteksi Mampet Otomatis">
<meta property="og:site_name" content="RooterIn">
<meta property="og:description" content="Gunakan teknologi AI (Computer Vision) Rooterin untuk mendeteksi masalah pipa Anda hanya dengan foto. Cepat, akurat, dan canggih.">

<meta name="twitter:title" content="Tips &amp; Trik Saluran Mampet - Rooterin">
<meta name="twitter:description" content="Kumpulan artikel bermanfaat mengenai perawatan pipa, cara mengatasi saluran mampet, dan tips sanitasi modern.">
<meta name="twitter:title" content="AI Visual Pipe Diagnostics - Deteksi Mampet Otomatis">
<meta name="twitter:description" content="Gunakan teknologi AI (Computer Vision) Rooterin untuk mendeteksi masalah pipa Anda hanya dengan foto. Cepat, akurat, dan canggih.">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"AI Visual Pipe Diagnostics - Deteksi Mampet Otomatis","description":"Gunakan teknologi AI (Computer Vision) Rooterin untuk mendeteksi masalah pipa Anda hanya dengan foto. Cepat, akurat, dan canggih."}</script>
    
    
    <link rel="alternate" hreflang="id" href="?lang=id" />
<link rel="alternate" hreflang="en" href="?lang=en" />
<link rel="alternate" hreflang="x-default" href="index.html" />
    
    
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"RooterIn","url":"","potentialAction":{"@type":"SearchAction","target":"search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"https://schema.org","@type":"LocalBusiness","name":"RooterIn","url":"","telephone":"0812-4666-8749","priceRange":"$$","image":"images/logo.png","address":{"@type":"PostalAddress","streetAddress":"Jakarta, Indonesia","addressLocality":"Jakarta","addressCountry":"ID"}}</script>


    <script>
        function trackWhatsAppClick(source = 'general') {
            fetch('api/track-whatsapp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    url: window.location.href,
                    source: source
                })
            });
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">

    <!-- Scripts -->
    <link rel="preload" as="style" href="build/assets/app-DS_HiWRs.css" /><link rel="modulepreload" as="script" href="build/assets/app-eFH5NDVu.js" /><link rel="stylesheet" href="build/assets/app-DS_HiWRs.css" /><script type="module" src="build/assets/app-eFH5NDVu.js"></script>
    
    <script type="speculationrules">
    {
      "prerender": [{
        "source": "list",
        "urls": ["", "layanan.html", "ai-diagnostic.html"]
      }, {
        "source": "document",
        "where": { "and": [
          { "href_matches": "area/*" },
          { "not": { "href_matches": "admin/*" }}
        ]},
        "eagerness": "moderate"
      }]
    }
    </script>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    </head>
<body class="font-sans antialiased bg-stone-50 text-slate-800">
    <div id="site-content" class="min-h-screen flex flex-col transition-all duration-300">
        <!-- Modern Floating Navbar -->
<nav x-data="{ open: false, scrolled: false }" 
     @scroll.window="scrolled = (window.pageYOffset > 50)"
     class="fixed top-0 left-0 right-0 z-50 pt-4 sm:pt-10 px-3 sm:px-4 transition-all duration-500 ease-in-out">
    
    <div :class="scrolled ? 'max-w-7xl py-3' : 'max-w-[85rem] py-4.5 sm:py-5.5'"
          class="mx-auto bg-secondary/95 backdrop-blur-xl border border-white/10 rounded-2xl sm:rounded-[1.75rem] shadow-[0_25px_50px_rgba(0,0,0,0.35)] transition-all duration-500 px-6 lg:px-9 flex items-center justify-between relative">
        
        <!-- Logo Area -->
        <div class="flex-shrink-0 flex items-center gap-4 group cursor-pointer relative">
            <div class="relative w-10 h-10 sm:w-12 sm:h-12 bg-primary flex items-center justify-center rounded-2xl shadow-lg shadow-primary/20 transition-all duration-500 group-hover:scale-105">
                <i class="ri-flashlight-fill text-white text-2xl sm:text-2xl"></i>
            </div>
            <div class="relative flex flex-col">
                <span class="font-heading font-black text-xl sm:text-2xl text-white tracking-widest leading-none">ROOTER<span class="text-primary">IN</span></span>
                <span class="hidden sm:block text-[9px] text-gray-500 font-black tracking-[0.4em] uppercase mt-1.5">Organic Plumbing Hub</span>
            </div>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden xl:flex items-center space-x-2">
                            <a href="index.html" 
                   class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-gray-400 hover:text-white">
                    Home
                                    </a>
                            <a href="about.html" 
                   class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-gray-400 hover:text-white">
                    About
                                    </a>
                            <a href="layanan.html" 
                   class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-gray-400 hover:text-white">
                    Layanan
                                    </a>
                            <a href="galeri.html" 
                   class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-gray-400 hover:text-white">
                    Gallery
                                    </a>
                            <a href="ai-diagnostic.html" 
                   class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-primary">
                    AI Diagnostic
                                            <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-[2px] bg-primary rounded-full"></span>
                                    </a>
            
            <!-- Branched Menu (Pengetahuan) -->
            <div x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false" class="relative group">
                <button class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 flex items-center gap-1.5 text-gray-400 hover:text-white">
                    <span>Pengetahuan</span>
                    <i class="ri-arrow-down-s-line text-[10px] transition-transform duration-300" :class="open ? 'rotate-180' : ''"></i>
                                    </button>
                
                <div x-show="open" 
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 translate-y-2 scale-95"
                     x-transition:enter-end="opacity-100 translate-y-0 scale-100"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 translate-y-0 scale-100"
                     x-transition:leave-end="opacity-0 translate-y-2 scale-95"
                     style="display: none;"
                     class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-secondary/95 backdrop-blur-2xl border border-white/10 rounded-2xl py-3 shadow-3xl z-[100]">
                    <a href="wiki.html" class="block px-6 py-3 text-[9px] font-black uppercase tracking-widest text-gray-400 hover:text-white hover:bg-white/5 transition-all">
                        WikiPipa
                    </a>
                    <a href="tips.html" class="block px-6 py-3 text-[9px] font-black uppercase tracking-widest text-gray-400 hover:text-white hover:bg-white/5 transition-all border-t border-white/5">
                        Tips & Trik
                    </a>
                </div>
            </div>

            <a href="kontak.html" 
               class="relative px-3 py-2 text-[9px] font-black uppercase tracking-[0.2em] transition-all duration-300 text-gray-400 hover:text-white">
                Kontak
            </a>
        </div>

        <!-- Ghostwriting Search Component -->
        <div x-data="ghostSearch()" class="hidden md:flex items-center gap-4 relative">
            <div x-show="searchOpen" class="absolute right-0 top-full mt-4 w-[400px] bg-secondary/95 backdrop-blur-3xl border border-white/10 rounded-3xl p-6 shadow-3xl z-[100]" x-cloak @click.away="searchOpen = false">
                <input type="text" x-model="query" @input.debounce.300ms="fetchSuggestions" placeholder="Cari masalah pipa anda..." class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white text-sm focus:outline-none focus:border-primary transition-all">
                
                <div class="mt-6 space-y-4 max-h-[300px] overflow-y-auto no-scrollbar">
                    <div x-show="loading" class="flex items-center justify-center py-10">
                        <div class="w-8 h-8 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div>
                    </div>
                    
                    <template x-if="!loading">
                        <div class="space-y-4">
                            <template x-for="item in results" :key="item.title">
                                <a :href="item.url" class="block p-4 rounded-2xl hover:bg-white/5 border border-transparent hover:border-white/5 transition-all group">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-[8px] font-black text-primary uppercase tracking-widest" x-text="item.type"></span>
                                    </div>
                                    <h4 class="text-white font-bold text-sm" x-text="item.title"></h4>
                                    <p class="text-slate-500 text-[10px] italic mt-1" x-text="item.snippet"></p>
                                </a>
                            </template>
                            <div x-show="results.length === 0 && query.length > 2" class="text-slate-500 text-xs italic text-center py-4">Tidak ada saran cepat...</div>
                        </div>
                    </template>
                </div>
            </div>

            <button @click="searchOpen = !searchOpen" class="w-11 h-11 flex items-center justify-center bg-white/5 border border-white/10 rounded-2xl text-gray-400 hover:text-white transition-all">
                <i :class="searchOpen ? 'ri-close-line' : 'ri-search-line'" class="text-xl"></i>
            </button>
        </div>

        <!-- Action Area -->
        <div class="flex items-center gap-3 sm:gap-5">
            <a href="https://wa.me/6281234567890" 
               class="hidden md:flex items-center gap-3 bg-white/5 hover:bg-white/10 border border-white/10 px-4 xl:px-6 py-2.5 xl:py-3 rounded-2xl transition-all duration-300 group">
                <div class="hidden xl:block text-right">
                    <div class="text-[9px] text-gray-400 font-black uppercase tracking-widest leading-none mb-1.5">Butuh Bantuan?</div>
                    <div class="text-white font-black text-[11px] uppercase tracking-widest leading-none">WhatsApp SOS</div>
                </div>
                <div class="w-8 h-8 xl:w-9 xl:h-9 bg-primary/20 rounded-xl flex items-center justify-center group-hover:bg-primary transition-all duration-300">
                    <i class="ri-whatsapp-line text-base xl:text-lg text-primary group-hover:text-white transition-colors"></i>
                </div>
            </a>

            <!-- Pop-out Hamburger -->
            <button @click="open = ! open" 
                    class="relative xl:hidden w-11 h-11 flex items-center justify-center rounded-2xl transition-all duration-500 z-[70]"
                    :class="open ? 'bg-primary scale-110 shadow-[0_10px_25px_rgba(31,175,90,0.4)]' : 'bg-white/10'">
                <div class="relative w-6 h-5 flex items-center justify-center">
                    <span class="absolute h-[3px] bg-white rounded-full transition-all duration-500 ease-[cubic-bezier(0.68,-0.6,0.32,1.6)]"
                          :class="open ? 'w-6 rotate-45' : 'w-6 -translate-y-2'"></span>
                    <span class="absolute h-[3px] bg-white rounded-full transition-all duration-300"
                          :class="open ? 'w-0 opacity-0 translate-x-4' : 'w-4 translate-x-1.5'"></span>
                    <span class="absolute h-[3px] bg-white rounded-full transition-all duration-500 ease-[cubic-bezier(0.68,-0.6,0.32,1.6)]"
                          :class="open ? 'w-6 -rotate-45' : 'w-6 translate-y-2'"></span>
                </div>
            </button>
        </div>
    </div>

    <!-- Smooth Mobile Menu Overlay: Hub & Landscape Optimized -->
    <div x-show="open" 
         x-transition:enter="transition ease-[cubic-bezier(0.34,1.56,0.64,1)] duration-700"
         x-transition:enter-start="opacity-0 translate-y-20 scale-90"
         x-transition:enter-end="opacity-100 translate-y-0 scale-100"
         x-transition:leave="transition ease-in duration-400"
         x-transition:leave-start="opacity-100 translate-y-0 scale-100"
         x-transition:leave-end="opacity-0 translate-y-10 scale-95"
         class="xl:hidden absolute top-[90px] sm:top-[120px] left-4 right-4 sm:left-8 sm:right-8 bg-secondary/98 backdrop-blur-3xl border border-white/10 rounded-[2rem] sm:rounded-[2.5rem] p-5 sm:p-8 shadow-[0_40px_100px_rgba(0,0,0,0.5)] max-h-[calc(100vh-140px)] overflow-y-auto no-scrollbar">
        
        <div class="relative flex flex-col gap-1 z-20">
                        
                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[60ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="index.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="group-hover:text-primary transition-all duration-300 group-hover:translate-x-2">Home</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[120ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="about.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="group-hover:text-primary transition-all duration-300 group-hover:translate-x-2">About Us</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[180ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="layanan.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="group-hover:text-primary transition-all duration-300 group-hover:translate-x-2">Services</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[240ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="ai-diagnostic.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="text-primary transition-all duration-300 group-hover:translate-x-2">AI Diagnostic</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[300ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="galeri.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="group-hover:text-primary transition-all duration-300 group-hover:translate-x-2">Project Gallery</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                                            <div x-show="open"
                     x-transition:enter="transition ease-out duration-600 delay-[360ms]"
                     x-transition:enter-start="opacity-0 translate-x-10 rotate-3"
                     x-transition:enter-end="opacity-100 translate-x-0 rotate-0">
                    <a @click="open = false" href="kontak.html" 
                       class="text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between border-b border-white/5 group">
                        <span class="group-hover:text-primary transition-all duration-300 group-hover:translate-x-2">Contact</span>
                        <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-primary transition-all duration-500 shadow-sm group-hover:shadow-primary/30">
                            <i class="ri-arrow-right-line text-gray-400 group-hover:text-white text-base transition-transform group-hover:translate-x-1"></i>
                        </div>
                    </a>
                </div>
                            
            <!-- Mobile Branched Menu (Knowledge Hub) -->
            <div x-data="{ subOpen: false }" 
                 x-show="open"
                 x-transition:enter="transition ease-out duration-600 delay-[500ms]"
                 class="border-b border-white/5">
                <button @click="subOpen = !subOpen" 
                        class="w-full text-base sm:text-lg font-black text-white py-2.5 sm:py-3.5 flex items-center justify-between group">
                    <span :class="subOpen ? 'text-primary' : 'group-hover:text-primary'" class="transition-all duration-300">Pengetahuan</span>
                    <i class="ri-add-line text-xl transition-transform duration-500" :class="subOpen ? 'rotate-45 text-primary' : 'text-gray-400'"></i>
                </button>
                
                <div x-show="subOpen" 
                     x-collapse
                     class="pl-4 pb-4 flex flex-col gap-2">
                    <a href="wiki.html" 
                       class="py-3 px-5 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-between ">
                        <span class="text-sm font-black text-gray-400 uppercase tracking-widest">WikiPipa</span>
                        <i class="ri-book-read-line text-gray-600"></i>
                    </a>
                    <a href="tips.html" 
                       class="py-3 px-5 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-between ">
                        <span class="text-sm font-black text-gray-400 uppercase tracking-widest">Tips & Trik</span>
                        <i class="ri-lightbulb-line text-gray-600"></i>
                    </a>
                </div>
            </div>
            
            <div class="mt-4 pt-4 flex flex-col gap-1 border-t border-white/5"
                 x-show="open"
                 x-transition:enter="transition ease-out duration-600 delay-[600ms]"
                 x-transition:enter-start="opacity-0 translate-y-10"
                 x-transition:enter-end="opacity-100 translate-y-0">
                <div class="flex items-center gap-3">
                    <div class="w-1.5 h-1.5 bg-primary rounded-full animate-ping shadow-[0_0_8px_#1FAF5A]"></div>
                    <span class="text-[8px] text-gray-400 font-black tracking-[0.3em] uppercase">Emergency Support Hub</span>
                </div>
                <div class="pl-4">
                    <a href="tel:6281246668749" class="text-xl sm:text-2xl font-black text-white hover:text-primary transition-all duration-300 inline-block tracking-tighter">6281246668749</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<script>
    function ghostSearch() {
        return {
            searchOpen: false,
            query: '',
            results: [],
            loading: false,
            async fetchSuggestions() {
                if(this.query.length < 3) {
                    this.results = [];
                    return;
                }
                this.loading = true;
                try {
                    const response = await fetch(`/api/search/suggest?q=${this.query}`);
                    this.results = await response.json();
                } finally {
                    this.loading = false;
                }
            }
        }
    }
</script>

        <main class="flex-grow">
            <script>
var _diag = {
    step: 0, busy: false, camOn: false, barTimer: null,
    vLabel: 'Potential Blockage', vScore: 85,
    aLabel: 'Standard Flow', aScore: 0,
    lat: null, lng: null,
    survey: { location:'', location_label:'', material:'pvc', sub_context:'dapur', frequency:'pertama', symptoms:[] },
    result: { id:'RT-PENDING', rank:'?', title:'', rec:'', tools:'' }
};

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        function(p){ _diag.lat = p.coords.latitude; _diag.lng = p.coords.longitude; },
        function(e){ console.warn('GPS:', e.message); },
        { timeout: 8000 }
    );
}

function _el(id){ return document.getElementById(id); }

function _toast(msg, isErr) {
    var t = _el('rt-toast');
    t.innerHTML = msg;
    t.style.display = 'block';
    t.style.opacity = '1';
    t.style.cssText = [
        'position:fixed;bottom:2.5rem;left:50%;transform:translateX(-50%) translateY(0);',
        'z-index:9999;padding:.6rem 1.25rem;border-radius:2rem;',
        'font-size:.6rem;font-weight:900;text-transform:uppercase;letter-spacing:.15em;',
        'box-shadow:0 10px 30px rgba(0,0,0,0.5); backdrop-filter:blur(10px);',
        'transition:all .4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-width:20rem; width:fit-content; text-align:center;',
        isErr
            ? 'background:rgba(220,38,38,0.9); color:#fff; border:1px solid rgba(239,68,68,0.3);'
            : 'background:rgba(34,197,94,0.9); color:#0f172a; border:1px solid rgba(74,222,128,0.3);'
    ].join('');
    
    clearTimeout(_diag._tt);
    _diag._tt = setTimeout(function(){ 
        t.style.opacity = '0';
        t.style.transform = 'translateX(-50%) translateY(20px)';
        setTimeout(function(){ t.style.display = 'none'; }, 400);
    }, 2800);
}

function _goStep(n) {
    _diag.step = n;
    
    var s0 = document.getElementById('s0');
    var s2 = document.getElementById('s2');
    if(s0) s0.style.display = (n === 0) ? 'block' : 'none';
    if(s2) s2.style.display = (n === 2) ? 'block' : 'none';

    var d0 = document.getElementById('d0');
    var d2 = document.getElementById('d2');
    var dl0 = document.getElementById('dl0');

    if(d0) {
        d0.style.background = '#22c55e';
        d0.style.color = '#0f172a';
        d0.style.boxShadow = '0 0 30px rgba(34,197,94,.3)';
    }

    if (n >= 2) {
        if(d2) {
            d2.style.background = '#22c55e';
            d2.style.color = '#0f172a';
            d2.style.boxShadow = '0 0 30px rgba(34,197,94,.3)';
        }
        if(dl0) { dl0.style.background = '#22c55e'; dl0.style.boxShadow = '0 0 15px rgba(34,197,94,.2)'; }
    } else {
        if(d2) { 
            d2.style.background = '#1e293b'; 
            d2.style.color = '#475569';
            d2.style.boxShadow = 'none';
        }
        if(dl0) { dl0.style.background = '#1e293b'; dl0.style.boxShadow = 'none'; }
    }
}

function _btnState(id, disabled, html) {
    var b = _el(id);
    b.disabled = disabled;
    b.innerHTML = html;
}

async function rtVision() {
    if (_diag.busy) return;
    _diag.busy = true;
    _btnState('btn-v', true, 'Handshake...');
    
    try {
        const hResp = await fetch('ai-diagnostic/handshake');
        const hData = await hResp.json();
        _diag.handshake = hData.token;
        _toast('Neural Handshake Active: Verified');
    } catch (e) {
        _toast('Handshake Failure: Using Local Cache', true);
    }

    _btnState('btn-v', true, 'Menangkap Visual...');
    _toast('Menyimpan frame observasi...');
    if (_diag.camOn) {
        _el('scan-ln').style.display = 'block';
    }

    setTimeout(function() {
        var v = _el('rt-vid');
        var c = _el('rt-cvs');
        if (_diag.uploadedBase64) {
             _diag.imageBase64 = _diag.uploadedBase64;
             _toast('Menggunakan gambar yang diunggah...');
        } else if (_diag.camOn && v && v.videoWidth > 0) {
            c.width = v.videoWidth;
            c.height = v.videoHeight;
            var ctx = c.getContext('2d');
            ctx.drawImage(v, 0, 0, c.width, c.height);
            _diag.imageBase64 = c.toDataURL('image/jpeg', 0.85); // Capture Real Base64 Image
        } else {
            // Fallback base64 transparent
            c.width = 640; c.height = 480;
            var ctx = c.getContext('2d');
            ctx.fillStyle = "#A9A9A9";
            ctx.fillRect(0, 0, 640, 480);
            ctx.fillStyle = "#ffffff";
            ctx.font = "30px Arial";
            ctx.fillText("Simulated Degradation Frame", 100, 240);
            _diag.imageBase64 = c.toDataURL('image/jpeg', 0.85);
        }

        _diag.vScore = 85; 
        if (_diag.camOn) _el('scan-ln').style.display = 'none';
        _diag.busy = false;

        _btnState('btn-v', false, '✓ Frame Captured');
        _toast('Frame visual disimpan! Lanjut Isi Survei ›');
        setTimeout(function(){ _goStep(2); }, 700);
    }, 600); 
}

function rtUploadFile(e) {
    var file = e.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(evt) {
            _diag.uploadedBase64 = evt.target.result;
            _diag.camOn = false;
            
            var v = _el('rt-vid');
            if (v) {
                if (v.srcObject) { v.srcObject.getTracks().forEach(function(t){ t.stop(); }); }
                v.srcObject = null;
                v.style.opacity = '0';
                v.style.display = 'none';
            }

            var hud = _el('cam-hud');
            if (hud) hud.style.display = 'none';

            var nc = _el('no-cam');
            if (nc) {
                nc.style.cssText = 'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:5;background:#000;';
                nc.innerHTML = '<img src="' + evt.target.result + '" style="width:100%;height:100%;object-fit:cover;">';
            }
            
            _toast('\u2713 Foto berhasil diunggah! Klik Analyze Visual');
            _btnState('btn-v', false, '\u25b6 Analyze Visual');
        };
        reader.readAsDataURL(file);
    }
}

function rtLocToggle(){
    var d = _el('loc-d');
    d.style.display = d.style.display === 'block' ? 'none' : 'block';
}
function rtLocSel(id, lbl){
    _diag.survey.location = id;
    _diag.survey.location_label = lbl;
    _el('loc-lbl').textContent = lbl;
    _el('loc-d').style.display = 'none';
}

function rtMat(id){
    _diag.survey.material = id;
    ['pvc','besi','flex'].forEach(function(m){
        var b = _el('mat-'+m);
        var active = m === id || (m==='flex' && id==='fleksibel') || (m==='pvc' && id==='pvc') || (m==='besi' && id==='besi');
        if ((m==='pvc' && id==='pvc')||(m==='besi' && id==='besi')||(m==='flex' && id==='fleksibel')) {
            b.style.background = '#22c55e'; b.style.color = '#0f172a';
        } else {
            b.style.background = 'rgba(255,255,255,.05)'; b.style.color = '#64748b';
        }
    });
    _el('sub-pvc').style.display = id==='pvc' ? 'block' : 'none';
}
function rtSub(id){
    _diag.survey.sub_context = id;
    ['dapur','km','talang'].forEach(function(s){
        var b = _el('sub-'+s);
        b.style.background = s===id ? '#22c55e' : '#1e293b';
        b.style.color = s===id ? '#0f172a' : '#64748b';
    });
}
function rtFreq(id){
    _diag.survey.frequency = id;
    ['pt','se','to'].forEach(function(s){
        var fmap = {pt:'pertama', se:'sering', to:'total'};
        var b = _el('fr-'+s);
        b.style.background = fmap[s]===id ? '#f97316' : 'rgba(255,255,255,.05)';
        b.style.color = fmap[s]===id ? '#fff' : '#64748b';
    });
}

function rtInfer(){
    var mat = _diag.survey.material;
    var ctx = (_diag.survey.sub_context||_diag.survey.location||'').toLowerCase();
    var lbl, tools;
    if (mat==='pvc'){
        if (ctx.includes('dapur')||ctx.includes('wastafel')||ctx.includes('grease')||ctx.includes('sink')){
            lbl='Endapan Lemak Beku / Grease FOG'; tools='Hydro Jetting Medium + Bio-Chemical Enzyme Cleaner';
        } else if (ctx.includes('km')||ctx.includes('floor')||ctx.includes('toilet')||ctx.includes('closet')){
            lbl='Gumpalan Rambut & Residu Sabun'; tools='Rooter Spiral Machine + Hair Catcher Removal';
        } else if (ctx.includes('talang')||ctx.includes('gutter')||ctx.includes('selokan')){
            lbl='Sampah Daun & Endapan Lumpur'; tools='High Pressure Water Jetting + Manual Scooping';
        } else {
            lbl='Benda Asing (Foreign Object)'; tools='Rooter K-400 + CCTV Pipe Inspection';
        }
    } else if (mat==='besi'){
        lbl='Korosi & Kerak Mineral (Scale)'; tools='Heavy-Duty Descaling + Chemical Pipe Relining';
    } else {
        lbl='Sisa Sabun & Kerak Lemak'; tools='Flexible Snake + Manual Section Replacement';
    }
    _diag.result.title = lbl;
    _diag.result.rec   = lbl;
    _diag.result.tools = tools;
    _diag.result.rank  = _diag.vScore > 85 ? 'A' : 'B';
}

function rtGenerate(){
    if (_diag.busy) return;

    // ── GUARD: Require camera or uploaded photo ──
    if (!_diag.imageBase64 && !_diag.uploadedBase64) {
        _toast('\u26a0\ufe0f Anda harus mengambil foto atau upload gambar pipa atau saluran terlebih dahulu!', true);
        return;
    }

    // Collect symptoms
    _diag.survey.symptoms = [];
    document.querySelectorAll('.rt-sym:checked').forEach(function(cb){ _diag.survey.symptoms.push(cb.value); });

    _diag.busy = true;
    _el('proc-ov').style.display = 'flex';
    _btnState('btn-g', true, 'ForensicAI Active...');
    _toast('<i class="ri-brain-line"></i> Inisiasi Gemini ForensicGuard v2.0...');
    
    var msgs = [
        'Layer 1: Memverifikasi subjek gambar pipa...',
        'Layer 2: Menganalisis kualitas & kejernihan foto...',
        'Layer 3: Cross-checking material vs visual...',
        'Layer 4: Diagnosis forensik mendalam ASTM D2321...',
        'Layer 5: Menyusun rekomendasi layanan...'
    ];
    msgs.forEach(function(m, i){
        setTimeout(function(){
            if (_diag.busy && _el('proc-msg')) _el('proc-msg').textContent = m;
        }, i * 2500);
    });

    var payload = {
        image_base64:      _diag.imageBase64 || null,
        result_label:      _diag.vLabel || 'Pending Engine Inference',
        city_location:     _diag.city || 'Auto Detect',
        material_type:     _diag.survey.material || 'unknown',
        location_context:  _diag.survey.location || 'umum',
        confidence_score:  parseInt(_diag.vScore) || 85,
        survey_data:       _diag.survey,
        recommended_tools: 'Professional Diagnostics Rooter Equipment',
        metadata: {
            symptoms: _diag.survey.symptoms || [],
            sub_context: _diag.survey.sub_context || ''
        }
    };
    if (_diag.lat !== null) { payload.latitude = _diag.lat; payload.longitude = _diag.lng; }

    fetch('ai-diagnostic/store', {
        method: 'POST',
        headers: { 
            'Content-Type':'application/json', 
            'X-CSRF-TOKEN':'am1CQIXKkgJluU2dnWXLCabshnd4pI9XUnP24WwP', 
            'Accept':'application/json',
            'X-Phantom-Token': _diag.handshake || ''
        },
        body: JSON.stringify(payload)
    })
    .then(function(r){ 
        return r.json().then(function(data){ 
            return { ok: r.ok, status: r.status, data: data }; 
        });
    })
    .then(function(res){
        _el('proc-ov').style.display = 'none';
        _btnState('btn-g', false, 'Generate Ulang');
        _diag.busy = false;

        if (!res.ok) {
            // ── Forensic Guard Rejection Handling ──
            var err = res.data;
            var code = err.error_code || '';
            
            if (code === 'NOT_PIPE') {
                // Layer 1: Not a pipe image — show full-screen rejection
                rtShowRejection(
                    'ri-error-warning-fill',
                    'Bukan Foto Pipa!',
                    err.message || 'Gambar tidak menampilkan pipa atau saluran.',
                    'Arahkan kamera ke pipa, saluran, atau area perpipaan yang bermasalah.',
                    '#ef4444'
                );
            } else if (code === 'POOR_IMAGE_QUALITY') {
                // Layer 2: Poor photo quality
                var iconClass = err.quality_type === 'TOO_DARK' ? 'ri-flashlight-line' : 'ri-camera-lens-line';
                rtShowRejection(
                    iconClass,
                    'Kualitas Foto Tidak Memadai',
                    err.message || 'Foto tidak cukup jelas untuk analisis forensik.',
                    'Ambil ulang foto dengan pencahayaan yang baik dan kamera yang stabil.',
                    '#f97316'
                );
            } else if (code === 'RATE_LIMIT_EXCEEDED') {
                rtShowRejection(
                    'ri-timer-flash-line',
                    'Limit Harian Tercapai',
                    err.message,
                    'Gunakan kuota diagnosa Anda secara bijak atau hubungi teknisi kami untuk bantuan langsung.',
                    '#3b82f6'
                );
            } else {
                _toast('<i class="ri-close-circle-line"></i> Terjadi kesalahan: ' + (err.message || 'Server Error'), true);
            }
            return;
        }
        
        // Success — pass correct data object and optional material warning
        rtShowResult(res.data || null, res.data.material_warning || null);
    })
    .catch(function(e){
        console.error('API Error:', e);
        _el('proc-ov').style.display = 'none';
        _btnState('btn-g', false, 'Generate Ulang');
        _diag.busy = false;
        rtShowResult(null, null);
    });
}

// ── FORENSIC REJECTION UI ─────────────────────────────────
function rtShowRejection(iconClass, title, reason, hint, color) {
    var m = _el('rt-modal');
    if (!m) return;

    m.innerHTML = `
    <div onclick="event.stopPropagation()" style="position:relative;width:100%;max-width:32rem;background:#0f172a;border:1px solid ${color}44;border-radius:2.5rem;padding:3rem;text-align:center;box-shadow:0 30px 60px rgba(0,0,0,.8), 0 0 100px ${color}11">
        <div style="width:5rem;height:5rem;background:${color}11;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem;border:1px solid ${color}22">
            <i class="${iconClass}" style="font-size:3rem;color:${color}"></i>
        </div>
        <h2 style="color:#fff;font-size:1.4rem;font-weight:900;margin:0 0 .75rem;line-height:1.2;letter-spacing:-0.02em">${title}</h2>
        
        <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:1.5rem;padding:1.5rem;margin-bottom:1.25rem">
            <p style="color:#94a3b8;font-size:.85rem;line-height:1.7;margin:0">${reason}</p>
        </div>

        <div style="background:rgba(34,197,94,.04);border:1px solid rgba(34,197,94,.1);border-radius:1.2rem;padding:1.2rem;margin-bottom:2rem;display:flex;gap:1rem;text-align:left;align-items:flex-start">
            <div style="width:1.8rem;height:1.8rem;background:rgba(34,197,94,.1);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:.1rem">
                <i class="ri-lightbulb-flash-line" style="color:#4ade80;font-size:1rem"></i>
            </div>
            <p style="color:#4ade80;font-size:.78rem;font-weight:700;line-height:1.6;margin:0">${hint}</p>
        </div>

        <button onclick="rtCloseModal(event); rtResetToStep0();" style="width:100%;padding:1.2rem;background:${color};color:#fff;border:none;border-radius:1.2rem;font-weight:900;font-size:.75rem;text-transform:uppercase;letter-spacing:.15em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.75rem;box-shadow:0 10px 30px ${color}44;transition:all .3s">
            <i class="ri-camera-lens-fill" style="font-size:1.2rem"></i> Ambil Foto Ulang
        </button>
    </div>`;

    m.style.setProperty('display', 'flex', 'important');
    m.style.setProperty('opacity', '1', 'important');
    m.style.setProperty('visibility', 'visible', 'important');
}

// Reset to step 0 for retake
function rtResetToStep0() {
    _diag.imageBase64    = null;
    _diag.uploadedBase64 = null;
    _diag.camOn          = false;
    _goStep(0);
    _btnState('btn-v', false, 'Analyze Visual');
    
    // Reset video element visibility
    var v = _el('rt-vid');
    if (v) { v.style.display = ''; v.style.opacity = '0'; }
    var nc = _el('no-cam');
    if (nc) { nc.style.cssText = 'position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2rem;z-index:2;background:#0f172a;'; }

    // Rebuild modal innerHTML for next use
    _el('rt-modal').innerHTML = document.getElementById('rt-modal-template').innerHTML;
}

function rtShowResult(res, materialWarning){
    console.log('[DEBUG] AI Response Received:', res);
    _el('proc-ov').style.display = 'none';
    _btnState('btn-g', false, 'Generate Ulang');
    _diag.busy = false;

    if (!res) {
        console.warn('[DEBUG] Using Fallback - Server response missing or error.');
    }

    // Use server result if available, otherwise fallback to local diag structure
    const finalData = res || {};
    const modelData = res.data || {}; // Handle lead model if present

    try {
        _el('m-id').textContent    = res.diagnose_id || modelData.diagnose_id || 'RT-UNKNOWN';
        _el('m-rank').textContent  = res.deep_ranking || modelData.final_deep_score || '?';
        _el('m-title').textContent = modelData.result_label || 'Analysis Complete';
        _el('m-rec').textContent   = modelData.result_label || 'Analisis Selesai';
        
        var toolsText = modelData.recommended_tools || 'Pemeriksaan manual dibutuhkan.';
        _el('m-tools').innerHTML   = toolsText.replace(/\. /g, '.<br><br>');
        
        // Integrated Service Link
        const meta = modelData.metadata || {};
        const serviceSlug = meta.recommended_service_slug || 'saluran-pembuangan-mampet';
        const serviceName = meta.recommended_service_name || 'Saluran Pembuangan Mampet';
        _diag.targetServiceUrl = "layanan.html" + serviceSlug;
        
        if (_el('m-service')) _el('m-service').textContent = serviceName;

        // Visual Updates
        const colors = { 'A':'#ef4444', 'B':'#f97316', 'C':'#eab308', 'D':'#22c55e', 'E':'#3b82f6' };
        const colorCode = res.deep_ranking || modelData.final_deep_score || 'B';
        const color = colors[colorCode] || '#64748b';
        _el('m-rank').style.color = color;

        // ── LAYER 3: Material Mismatch Warning Banner
        var warnEl = _el('m-material-warn');
        if (warnEl) {
            if (materialWarning) {
                warnEl.style.display = 'block';
                warnEl.innerHTML = '<i class="ri-alert-line" style="font-size:.85rem"></i> ' + materialWarning;
            } else {
                warnEl.style.display = 'none';
            }
        }
        
        _toast(res ? '<i class="ri-checkbox-circle-fill"></i> Diagnosis ForensicAI Selesai!' : 'Diagnosis Fallback Aktif (Offline)', !res);
        
        // Final Display Trigger
        setTimeout(function(){ 
            var m = _el('rt-modal');
            if (m) {
                m.style.setProperty('display', 'flex', 'important');
                m.style.setProperty('opacity', '1', 'important');
                m.style.setProperty('visibility', 'visible', 'important');
                console.log('[DEBUG] Modal Display Triggered Successfully');
            }
        }, 100);
    } catch (err) {
        console.error('[FATAL] Modal Injection Error:', err);
        _toast('Gagal memproses data laporan', true);
    }
}


function rtCloseModal(e){ 
    if (e) {
        e.preventDefault();
        e.stopPropagation();
    }
    // Hard hide
    var m = _el('rt-modal');
    if (m) {
        m.style.setProperty('display', 'none', 'important');
        m.style.setProperty('opacity', '0', 'important');
    }
}

function rtPesanLayanan(){
    window.location.href = _diag.targetServiceUrl || 'services';
}

function rtWA(){
    const url = 'admin/api/track-whatsapp';
    const data = new URLSearchParams();
    data.append('url', window.location.href);
    data.append('source', 'ai_diagnostic_result');

    // Attempt tracking with multiple layers of reliability
    if (navigator.sendBeacon) {
        navigator.sendBeacon(url, data);
    } else {
        fetch(url, { method: 'POST', body: data, keepalive: true });
    }

    var text = '*ROOTERIN DEEP DIAGNOSTIC*\n\n'+
        'ID: *'+_diag.result.id+'*\nRanking: *'+_diag.result.rank+'*\n\n'+
        'Diagnosa: *'+_diag.result.title+'*\n'+
        'Alat: '+_diag.result.tools+'\n\n'+
        'Material: '+(_diag.survey.material||'-').toUpperCase()+'\n'+
        'Lokasi: '+(_diag.survey.sub_context||_diag.survey.location||'umum').toUpperCase()+'\n\n'+
        '_Mohon segera dijadwalkan inspeksi._';
    
    // Tiny delay to allow tracking to initiate
    setTimeout(function(){
        window.open('https://wa.me/6281234567890?text=' + encodeURIComponent(text), '_blank');
    }, 100);
}

// Close loc dropdown on outside click
document.addEventListener('click', function(e){
    var w = _el('loc-wrap');
    if (w && !w.contains(e.target)) {
        var d = _el('loc-d');
        if (d) d.style.display = 'none';
    }
});

// Block Escape key from closing modal via Alpine.js or other handlers
document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') {
        var m = _el('rt-modal');
        if (m && m.style.display !== 'none') {
            e.stopImmediatePropagation();
            e.preventDefault();
        }
    }
}, true); // capture phase = blocks before Alpine.js sees it

// NOTE: Vite HMR guard removed — import.meta is not available in Blade classic scripts.
</script>


<div id="rt-toast" style="display:none;opacity:0"></div>


<div id="proc-ov" style="display:none;position:fixed;inset:0;z-index:8888;background:rgba(2,6,23,.88);backdrop-filter:blur(14px);flex-direction:column;align-items:center;justify-content:center">
    <div style="position:relative;width:5rem;height:5rem;margin-bottom:1.5rem">
        <div style="position:absolute;inset:0;width:5rem;height:5rem;border:4px solid #22c55e;border-top-color:transparent;border-radius:50%;animation:rtspin .8s linear infinite"></div>
        <div style="position:absolute;inset:.75rem;border:4px solid #f97316;border-bottom-color:transparent;border-radius:50%;animation:rtspinr .6s linear infinite"></div>
    </div>
    <p style="color:#fff;font-size:.85rem;font-weight:900;text-transform:uppercase;letter-spacing:.2em;margin:0">Mengkalkulasi...</p>
    <p id="proc-msg" style="color:#64748b;font-size:.65rem;margin:.3rem 0 0">Neural Fusion Processing</p>
    <style>@keyframes rtspin{to{transform:rotate(360deg)}}@keyframes rtspinr{to{transform:rotate(-360deg)}}</style>
</div>


<div id="rt-modal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(2,6,23,.97);backdrop-filter:blur(24px);align-items:center;justify-content:center;padding:1rem">
    <div onclick="event.stopPropagation()" style="position:relative;width:100%;max-width:38rem;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:2.5rem;padding:2.5rem;max-height:85vh;overflow-y:auto;box-shadow:0 0 100px rgba(34,197,94,.15);scrollbar-width:thin;scrollbar-color:#1e293b transparent">
        
        
        <button id="rt-close-x" onclick="rtCloseModal(event)" style="position:absolute;top:1.5rem;right:1.5rem;background:rgba(255,255,255,.05);border:none;width:2.5rem;height:2.5rem;border-radius:50%;color:#64748b;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;font-size:1.2rem;transition:all .3s"><i class="ri-close-line"></i></button>

        
        <div style="display:flex;justify-content:center;margin-bottom:1.5rem">
            <div style="width:7rem;height:7rem;border-radius:50%;padding:.2rem;background:linear-gradient(135deg,#4ade80,#fb923c,#ea580c)">
                <div style="width:100%;height:100%;background:#020617;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center">
                    <span id="m-rank" style="font-size:3.5rem;font-weight:900;color:#fff;font-style:italic;line-height:1">?</span>
                    <span style="font-size:.55rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.15em;margin-top:.2rem">AI Score</span>
                </div>
            </div>
        </div>              
    
        
        <div style="text-align:center;margin-bottom:1.25rem">
            <h2 id="m-title" style="font-size:1.05rem;font-weight:900;color:#fff;margin:0 0 .75rem;line-height:1.3">Menganalisa...</h2>
            <div style="display:inline-flex;align-items:center;gap:.5rem;padding:.3rem .85rem;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:5rem">
                <span style="width:.5rem;height:.5rem;background:#22c55e;border-radius:50%;display:inline-block"></span>
                <span style="font-size:.6rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.12em">ID: <span id="m-id">—</span></span>
            </div>
        </div>                                                                          

        
        <div style="background:rgba(34,197,94,.04);border:1px solid rgba(34,197,94,.15);border-radius:1.2rem;padding:1.4rem;margin-bottom:.85rem">
            <div style="font-size:.6rem;font-weight:900;color:#22c55e;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Diagnosa Utama</div>
            <p id="m-rec" style="color:#fff;font-size:.95rem;font-weight:700;line-height:1.5;margin:0;letter-spacing:-0.01em">—</p>
        </div>
        
        <div id="m-material-warn" style="display:none;background:rgba(234,179,8,.1);border:1px solid rgba(234,179,8,.3);color:#eab308;font-size:.7rem;padding:.75rem;border-radius:.75rem;margin-bottom:1rem;font-weight:700;line-height:1.4"></div>

        <div style="background:rgba(2,6,23,.8);border:1px solid rgba(255,255,255,.05);border-radius:1rem;padding:1.1rem;margin-bottom:1.25rem;display:flex;align-items:center;gap:.85rem">
            <div style="width:2.75rem;height:2.75rem;background:rgba(249,115,22,.1);border-radius:.65rem;display:flex;align-items:center;justify-content:center;flex-shrink:0">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" style="width:1.2rem;height:1.2rem"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </div>
            <div>
                <div style="font-size:.6rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.12em;margin-bottom:.3rem">Alat Teknis</div>
                <p id="m-tools" style="color:#e2e8f0;font-size:.75rem;font-weight:600;line-height:1.4;margin:0">—</p>
            </div>
        </div>

        
        <button onclick="rtPesanLayanan()" style="width:100%;padding:1.1rem;background:#fff;color:#0f172a;border:none;border-radius:1.2rem;font-weight:900;font-size:.7rem;text-transform:uppercase;letter-spacing:.15em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom:.6rem;box-shadow:0 10px 30px rgba(255,255,255,0.1)">
            PESAN LAYANAN SEKARANG
        </button>
        
        <a id="m-wa" href="#" target="_blank" style="width:100%;padding:1rem;background:#22c55e;color:#fff;text-decoration:none;border-radius:1.2rem;font-weight:900;font-size:.7rem;text-transform:uppercase;letter-spacing:.15em;display:flex;align-items:center;justify-content:center;gap:.6rem;transition:all .3s">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width:1.2rem;height:1.2rem"><path d="M12.011 2c-5.511 0-9.989 4.478-9.989 9.989 0 1.762.459 3.415 1.259 4.856l-1.281 4.673 4.783-1.255c1.405.748 3.003 1.177 4.703 1.177 5.511 0 9.989-4.478 9.989-9.989S17.521 2 12.011 2zm0 16.5c-1.579 0-3.056-.445-4.312-1.215l-.31-.188-2.613.685.698-2.541-.212-.338c-.859-1.371-1.351-2.99-1.351-4.724 0-4.68 3.809-8.489 8.489-8.489s8.489 3.809 8.489 8.489-3.809 8.489-8.489 8.489z"/></svg>
            Konsultasi WhatsApp
        </a>
    </div>
</div>


<script id="rt-modal-template" type="text/template">
    <div onclick="event.stopPropagation()" style="position:relative;width:100%;max-width:38rem;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:2.5rem;padding:2.5rem;max-height:85vh;overflow-y:auto;box-shadow:0 0 100px rgba(34,197,94,.15);">
        <button id="rt-close-x" onclick="rtCloseModal(event)" style="position:absolute;top:1.5rem;right:1.5rem;background:rgba(255,255,255,.05);border:none;width:2.5rem;height:2.5rem;border-radius:50%;color:#64748b;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;font-size:1.2rem;"><i class="ri-close-line"></i></button>
        <div style="display:flex;justify-content:center;margin-bottom:1.5rem">
            <div style="width:7rem;height:7rem;border-radius:50%;padding:.2rem;background:linear-gradient(135deg,#4ade80,#fb923c,#ea580c)">
                <div style="width:100%;height:100%;background:#020617;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center">
                    <span id="m-rank" style="font-size:3.5rem;font-weight:900;color:#fff;font-style:italic;line-height:1">?</span>
                    <span style="font-size:.55rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.15em;margin-top:.2rem">AI Score</span>
                </div>
            </div>
        </div>
        <div style="text-align:center;margin-bottom:1.25rem">
            <h2 id="m-title" style="font-size:1.05rem;font-weight:900;color:#fff;margin:0 0 .75rem;line-height:1.3">Menganalisa...</h2>
            <div style="display:inline-flex;align-items:center;gap:.5rem;padding:.3rem .85rem;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:5rem">
                <span style="width:.5rem;height:.5rem;background:#22c55e;border-radius:50%;display:inline-block"></span>
                <span style="font-size:.6rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.12em">ID: <span id="m-id">&mdash;</span></span>
            </div>
        </div>
        <div style="background:rgba(34,197,94,.04);border:1px solid rgba(34,197,94,.15);border-radius:1.2rem;padding:1.4rem;margin-bottom:.85rem">
            <div style="font-size:.6rem;font-weight:900;color:#22c55e;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Diagnosa Utama</div>
            <p id="m-rec" style="color:#fff;font-size:.95rem;font-weight:700;line-height:1.5;margin:0;">&mdash;</p>
        </div>
        <div style="background:rgba(59,130,246,.04);border:1px solid rgba(59,130,246,.15);border-radius:1rem;padding:1.1rem;margin-bottom:.75rem">
            <div style="font-size:.6rem;font-weight:900;color:#3b82f6;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.5rem">Layanan RooterIN</div>
            <p id="m-service" style="color:#fff;font-size:1rem;font-weight:900;line-height:1.3;margin:0">Saluran Pembuangan Mampet</p>
        </div>
        <div id="m-material-warn" style="display:none;background:rgba(234,179,8,.1);border:1px solid rgba(234,179,8,.3);color:#eab308;font-size:.7rem;padding:.75rem;border-radius:.75rem;margin-bottom:1rem;font-weight:700;line-height:1.4"></div>
        <div style="background:rgba(2,6,23,.8);border:1px solid rgba(255,255,255,.05);border-radius:1rem;padding:1.1rem;margin-bottom:1.25rem;display:flex;align-items:center;gap:.85rem">
            <div style="width:2.75rem;height:2.75rem;background:rgba(249,115,22,.1);border-radius:.65rem;display:flex;align-items:center;justify-content:center;flex-shrink:0">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" style="width:1.2rem;height:1.2rem"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </div>
            <div>
                <div style="font-size:.6rem;font-weight:900;color:#475569;text-transform:uppercase;letter-spacing:.12em;margin-bottom:.3rem">Alat Teknis</div>
                <p id="m-tools" style="color:#e2e8f0;font-size:.75rem;font-weight:600;line-height:1.4;margin:0;">&mdash;</p>
            </div>
        </div>
        <button onclick="rtPesanLayanan()" style="width:100%;padding:1.1rem;background:#fff;color:#0f172a;border:none;border-radius:1.2rem;font-weight:900;font-size:.7rem;text-transform:uppercase;letter-spacing:.15em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom:.6rem;">PESAN LAYANAN SEKARANG</button>
        <a id="m-wa" href="#" target="_blank" style="width:100%;padding:1rem;background:#22c55e;color:#fff;text-decoration:none;border-radius:1.2rem;font-weight:900;font-size:.7rem;text-transform:uppercase;letter-spacing:.15em;display:flex;align-items:center;justify-content:center;gap:.6rem;">Konsultasi WhatsApp</a>
    </div>
</script>


<section style="background:#020617;min-height:100vh;padding-top:7rem;padding-bottom:5rem;position:relative;overflow-x:hidden">
    <div style="position:absolute;inset:0;opacity:.04;pointer-events:none;background-image:radial-gradient(#22c55e 1px,transparent 1px);background-size:36px 36px"></div>
    <div style="position:absolute;inset:0;background:linear-gradient(to bottom,#020617 0%,transparent 30%,transparent 70%,#020617 100%);pointer-events:none"></div>

    <div class="container mx-auto" style="padding:0 1rem;position:relative;z-index:1">

        
        <div style="text-align:center;margin-bottom:2.5rem">
            <h1 style="font-size:clamp(2.8rem,8vw,5.5rem);font-weight:900;color:#fff;line-height:.9;letter-spacing:-.04em;font-style:italic;margin:3.5rem 0 1rem 0">
                Magic <br><span style="background:linear-gradient(135deg,#4ade80,#fb923c,#ea580c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Deep Vision.</span>
            </h1>
            <p style="color:#64748b;font-size:.85rem;max-width:28rem;margin:0 auto">Analisis AI multi-sensor untuk mendeteksi jenis sumbatan pipa secara presisi.</p>
        </div>

        
        <div style="max-width:20rem;margin:0 auto 3rem;display:flex;align-items:center;justify-content:center;gap:1.5rem">
            <div style="display:flex;flex-direction:column;align-items:center;gap:.75rem">
                <div id="d0" style="width:3rem;height:3rem;border-radius:1rem;background:#22c55e;color:#0f172a;display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:900;box-shadow:0 0 30px rgba(34,197,94,.3);transition:all .3s"><i class="ri-camera-lens-line"></i></div>
                <span style="font-size:.6rem;font-weight:900;color:#22c55e;text-transform:uppercase;letter-spacing:.15em">Visual</span>
            </div>
            <div id="dl0" style="width:4rem;height:2px;background:#1e293b;border-radius:1px;margin-bottom:1.5rem;transition:all .3s"></div>
            <div style="display:flex;flex-direction:column;align-items:center;gap:.75rem">
                <div id="d2" style="width:3rem;height:3rem;border-radius:1rem;background:#1e293b;color:#475569;display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:900;transition:all .3s"><i class="ri-survey-line"></i></div>
                <span style="font-size:.6rem;font-weight:900;color:#64748b;text-transform:uppercase;letter-spacing:.15em">Kondisi</span>
            </div>
        </div>

        
        <div style="max-width:26rem;margin:0 auto">
            <div style="background:rgba(15,23,42,.8);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08);border-radius:3rem;overflow:hidden;box-shadow:0 40px 80px rgba(0,0,0,.6)">

                
                <div id="s0" style="display:block">
                    <div style="position:relative;aspect-ratio:1/1;background:#000;overflow:hidden;border-bottom:1px solid rgba(255,255,255,.05)">
                        <video id="rt-vid" autoplay playsinline muted style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .5s"></video>
                        <canvas id="rt-cvs" style="display:none"></canvas>

                        
                        <div id="no-cam" style="position:absolute;inset:0;background:#0f172a;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2rem;z-index:2">
                            <div style="width:4.5rem;height:4.5rem;background:rgba(30,41,59,.5);border:1px dashed rgba(255,255,255,.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:1.5rem">
                                <i class="ri-camera-off-line" style="font-size:1.5rem;color:#475569"></i>
                            </div>
                            <p style="color:#64748b;font-size:.8rem;font-weight:600;margin:0 0 .5rem">Sistem Kamera Offline</p>
                            <label style="cursor:pointer;color:#22c55e;font-size:.65rem;font-weight:900;text-transform:uppercase;margin:0;padding:.6rem 1.2rem;background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.2);border-radius:2rem;margin-top:.5rem;display:inline-block;transition:all .3s">
                                <i class="ri-upload-cloud-2-line"></i> Upload Foto Lokal
                                <input type="file" accept="image/*" style="display:none" onchange="rtUploadFile(this)">
                            </label>
                        </div>

                        
                        <div id="cam-hud" style="position:absolute;inset:0;pointer-events:none;display:none">
                            <div style="position:absolute;inset:1.5rem;border:2px solid rgba(34,197,94,.3);border-radius:1.2rem;overflow:hidden">
                                <div id="scan-ln" style="position:absolute;left:0;width:100%;height:2px;background:#22c55e;box-shadow:0 0 10px #22c55e;display:none;animation:rtscanmv 2s linear infinite"></div>
                            </div>
                            <div style="position:absolute;top:.85rem;left:1.1rem">
                                <div style="font-family:monospace;font-size:.6rem;color:#22c55e;font-weight:700">CAM: LIVE</div>
                            </div>
                        </div>
                    </div>
                    <div style="padding:1.1rem;display:flex;flex-direction:column;gap:.5rem">
                        <button id="btn-v" onclick="rtVision()"
                                style="width:100%;padding:1rem;background:#fff;color:#0f172a;border:none;border-radius:.85rem;font-weight:900;font-size:.65rem;text-transform:uppercase;letter-spacing:.15em;cursor:pointer">
                            Analyze Visual
                        </button>
                        <label style="cursor:pointer;color:#94a3b8;font-size:.6rem;font-weight:900;text-transform:uppercase;margin:0;padding:.8rem;background:rgba(255,255,255,.05);border-radius:.85rem;text-align:center;display:block">
                            ATAU UPLOAD FOTO SENDIRI
                            <input type="file" accept="image/*" style="display:none" onchange="rtUploadFile(this)">
                        </label>
                    </div>
                </div>

                
                    </div>
                    <div style="padding:1.5rem;display:flex;flex-direction:column;gap:.75rem">
                        <button id="btn-v" onclick="rtVision()"
                                style="width:100%;padding:1.1rem;background:#fff;color:#0f172a;border:none;border-radius:1.2rem;font-weight:900;font-size:.75rem;text-transform:uppercase;letter-spacing:.15em;cursor:pointer;box-shadow:0 10px 30px rgba(255,255,255,.1)">
                            Mulai Analisis Visual
                        </button>
                        <label style="cursor:pointer;color:#94a3b8;font-size:.65rem;font-weight:900;text-transform:uppercase;margin:0;padding:.9rem;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:1.2rem;text-align:center;display:block;transition:all .3s">
                            <i class="ri-folder-upload-line"></i> Pilih File Gambar
                            <input type="file" accept="image/*" style="display:none" onchange="rtUploadFile(this)">
                        </label>
                    </div>
                </div>

                
                <div id="s2" style="display:none">
                    <div style="padding:1.5rem 1.5rem .75rem;border-bottom:1px solid rgba(255,255,255,.05)">
                        <h3 style="color:#fff;font-weight:900;font-size:.75rem;text-transform:uppercase;letter-spacing:.2em;margin:0 0 .5rem">Technical Survey</h3>
                        <div style="width:2.5rem;height:.25rem;background:linear-gradient(to right,#22c55e,#4ade80);border-radius:.1rem"></div>
                    </div>
                    <div style="padding:1.5rem;max-height:28rem;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.1) transparent">

                        
                        <div id="loc-wrap" style="margin-bottom:1.5rem;position:relative">
                            <div style="font-size:.6rem;font-weight:900;color:#64748b;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Lokasi Perpipaan</div>
                            <button onclick="rtLocToggle()"
                                    style="width:100%;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:1rem;padding:1rem 1.25rem;display:flex;align-items:center;justify-content:space-between;color:#fff;font-size:.7rem;font-weight:700;text-transform:uppercase;cursor:pointer;transition:all .3s">
                                <span id="loc-lbl">Konfigurasi Jalur...</span>
                                <i class="ri-arrow-down-s-line" style="font-size:1rem;color:#22c55e"></i>
                            </button>
                            <div id="loc-d" style="display:none;position:absolute;z-index:50;top:100%;left:0;right:0;margin-top:.5rem;background:#0f172a;border:1px solid rgba(255,255,255,.1);border-radius:1.2rem;overflow:hidden;box-shadow:0 30px 60px rgba(0,0,0,.8);backdrop-filter:blur(30px)">
                                <button onclick="rtLocSel('wastafel_dapur','Wastafel Dapur')" style="width:100%;text-align:left;padding:1rem 1.25rem;font-size:.65rem;font-weight:700;color:#94a3b8;text-transform:uppercase;cursor:pointer;border:none;background:transparent;border-bottom:1px solid rgba(255,255,255,.03)">Wastafel Dapur (Grease)</button>
                                <button onclick="rtLocSel('toilet_closet','Toilet / Closet')" style="width:100%;text-align:left;padding:1rem 1.25rem;font-size:.65rem;font-weight:700;color:#94a3b8;text-transform:uppercase;cursor:pointer;border:none;background:transparent;border-bottom:1px solid rgba(255,255,255,.03)">Toilet / Closet</button>
                                <button onclick="rtLocSel('floor_drain_km','Floor Drain KM')" style="width:100%;text-align:left;padding:1rem 1.25rem;font-size:.65rem;font-weight:700;color:#94a3b8;text-transform:uppercase;cursor:pointer;border:none;background:transparent;border-bottom:1px solid rgba(255,255,255,.03)">Floor Drain KM</button>
                                <button onclick="rtLocSel('kitchen_main','Jalur Utama Sink')" style="width:100%;text-align:left;padding:1rem 1.25rem;font-size:.65rem;font-weight:700;color:#94a3b8;text-transform:uppercase;cursor:pointer;border:none;background:transparent;border-bottom:1px solid rgba(255,255,255,.03)">Jalur Utama Sink</button>
                                <button onclick="rtLocSel('external_gutter','Talang / Selokan')" style="width:100%;text-align:left;padding:1rem 1.25rem;font-size:.65rem;font-weight:700;color:#94a3b8;text-transform:uppercase;cursor:pointer;border:none;background:transparent">Talang / Selokan</button>
                            </div>
                        </div>

                        
                        <div style="margin-bottom:1.5rem">
                            <div style="font-size:.6rem;font-weight:900;color:#64748b;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Material Instalasi</div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem">
                                <button id="mat-pvc" onclick="rtMat('pvc')" style="padding:.9rem;background:#22c55e;color:#0f172a;border:none;border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;transition:all .3s">PVC / Plastik</button>
                                <button id="mat-besi" onclick="rtMat('besi')" style="padding:.9rem;background:rgba(255,255,255,.04);color:#64748b;border:1px solid rgba(255,255,255,.06);border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;transition:all .3s">Cast Iron / Besi</button>
                                <button id="mat-flex" onclick="rtMat('fleksibel')" style="padding:.9rem;background:rgba(255,255,255,.04);color:#64748b;border:1px solid rgba(255,255,255,.06);border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;grid-column:1/-1;transition:all .3s">Selang Fleksibel</button>
                            </div>
                        </div>

                        
                        <div id="sub-pvc" style="margin-bottom:1.5rem;background:rgba(34,197,94,.03);border:1px solid rgba(34,197,94,.1);border-radius:1.2rem;padding:1.2rem">
                            <div style="font-size:.6rem;font-weight:900;color:#22c55e;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.5rem">Konfigurasi PVC</div>
                            <button id="sub-dapur" onclick="rtSub('dapur')" style="width:100%;padding:.75rem;background:#22c55e;color:#0f172a;border:none;border-radius:.75rem;font-weight:900;font-size:.63rem;text-transform:uppercase;cursor:pointer;margin-bottom:.5rem;display:block">Kitchen Sink Area</button>
                            <button id="sub-km" onclick="rtSub('km')" style="width:100%;padding:.75rem;background:#1e293b;color:#475569;border:none;border-radius:.75rem;font-weight:900;font-size:.63rem;text-transform:uppercase;cursor:pointer;margin-bottom:.5rem;display:block">Kamar Mandi / Drain</button>
                            <button id="sub-talang" onclick="rtSub('talang')" style="width:100%;padding:.75rem;background:#1e293b;color:#475569;border:none;border-radius:.75rem;font-weight:900;font-size:.63rem;text-transform:uppercase;cursor:pointer;display:block">Talang Air Utama</button>
                        </div>

                        
                        <div style="margin-bottom:1.5rem">
                            <div style="font-size:.6rem;font-weight:900;color:#64748b;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Deep Analysis History</div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem">
                                <button id="fr-pt" onclick="rtFreq('pertama')" style="padding:.9rem;background:#f97316;color:#fff;border:none;border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;transition:all .3s">Baru Pertama</button>
                                <button id="fr-se" onclick="rtFreq('sering')" style="padding:.9rem;background:rgba(255,255,255,.04);color:#64748b;border:1px solid rgba(255,255,255,.06);border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;transition:all .3s">Sering Mampet</button>
                                <button id="fr-to" onclick="rtFreq('total')" style="padding:.9rem;background:rgba(255,255,255,.04);color:#64748b;border:1px solid rgba(255,255,255,.06);border-radius:.85rem;font-weight:900;font-size:.6rem;text-transform:uppercase;cursor:pointer;grid-column:1/-1;transition:all .3s">Mampet Total</button>
                            </div>
                        </div>

                        
                        <div>
                            <div style="font-size:.6rem;font-weight:900;color:#64748b;text-transform:uppercase;letter-spacing:.15em;margin-bottom:.6rem">Observasi Lapangan</div>
                            <label style="display:flex;align-items:center;gap:.75rem;padding:1rem;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.04);border-radius:1rem;cursor:pointer;margin-bottom:.5rem;transition:all .3s">
                                <input type="checkbox" value="bau" class="rt-sym" style="accent-color:#22c55e;width:1.1rem;height:1.1rem;flex-shrink:0">
                                <span style="font-size:.63rem;font-weight:700;color:#64748b;text-transform:uppercase">Aroma Tidak Sedap Kuat</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:.75rem;padding:1rem;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.04);border-radius:1rem;cursor:pointer;margin-bottom:.5rem;transition:all .3s">
                                <input type="checkbox" value="kecoa" class="rt-sym" style="accent-color:#22c55e;width:1.1rem;height:1.1rem;flex-shrink:0">
                                <span style="font-size:.63rem;font-weight:700;color:#64748b;text-transform:uppercase">Aktivitas Hama / Kecoa</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:.75rem;padding:1rem;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.04);border-radius:1rem;cursor:pointer;transition:all .3s">
                                <input type="checkbox" value="berisik" class="rt-sym" style="accent-color:#22c55e;width:1.1rem;height:1.1rem;flex-shrink:0">
                                <span style="font-size:.63rem;font-weight:700;color:#64748b;text-transform:uppercase">Pipa Berbunyi (Gurgling)</span>
                            </label>
                        </div>
                    </div>

                    
                    <div style="padding:1.5rem;border-top:1px solid rgba(255,255,255,.05);background:rgba(15,23,42,.4)">
                        <button id="btn-g" onclick="rtGenerate()"
                                style="width:100%;padding:1.15rem;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;border:none;border-radius:1.2rem;font-weight:900;font-size:.75rem;text-transform:uppercase;letter-spacing:.2em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.6rem;box-shadow:0 10px 30px rgba(249,115,22,.2)">
                            Generate Forensic AI
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>
</section>

<style>
@keyframes rtscanmv {
    0%   { top:0;     opacity:0 }
    5%   { opacity:1 }
    95%  { opacity:1 }
    100% { top:100%;  opacity:0 }
}
</style>


<script>
(function(){
    var v = document.getElementById('rt-vid');
    if (!v || !navigator.mediaDevices) return;
    navigator.mediaDevices.getUserMedia({ video:{ facingMode:{ ideal:'environment' } } })
        .then(function(s){
            v.srcObject = s;
            v.style.opacity = '1';
            document.getElementById('no-cam').style.display = 'none';
            document.getElementById('cam-hud').style.display = 'block';
            _diag.camOn = true;
        })
        .catch(function(e){ console.warn('Cam:', e.message); });
})();
</script>
        </main>

        <!-- Unique Organic Footer -->
<footer class="bg-secondary text-white pt-24 pb-12 relative overflow-hidden">
    <!-- Abstract Background Elements -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[1px] bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
    <div class="absolute -bottom-24 -left-24 w-96 h-96 bg-primary/10 rounded-full blur-[120px] pointer-events-none"></div>
    
    <div class="max-w-7xl mx-auto px-6 sm:px-10 relative z-10">
        <div class="flex flex-col lg:flex-row justify-between gap-20 mb-20">
            <!-- Brand & Big Statement -->
            <div class="lg:w-1/3">
                <div class="flex items-center gap-4 mb-8 group cursor-default">
                    <div class="w-12 h-12 bg-primary rounded-2xl flex items-center justify-center shadow-lg shadow-primary/20 transition-transform duration-500 group-hover:rotate-12">
                        <i class="ri-flashlight-fill text-white text-2xl"></i>
                    </div>
                    <span class="font-heading font-black text-3xl tracking-tighter uppercase">ROOTER<span class="text-primary italic">IN</span></span>
                </div>
                <h2 class="text-3xl sm:text-4xl font-heading font-black text-white leading-tight mb-8">
                    Solusi <span class="text-primary italic">Pipa Lancar</span> <br>Tanpa <span class="text-gray-400 italic">Bongkar!</span>
                </h2>
                <p class="text-gray-400 text-base leading-relaxed mb-10 max-w-sm font-medium">
                    Layanan plumbing premium pertama di Indonesia yang menggabungkan teknologi modern dengan visi pelestarian alam.
                </p>
                <!-- Social Links with Animation -->
                <div class="flex gap-4">
                    <a href="#" class="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center hover:bg-primary hover:border-primary transition-all duration-500 group">
                        <i class="ri-instagram-line text-xl text-gray-400 group-hover:text-white transition-colors"></i>
                    </a>
                    <a href="#" class="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center hover:bg-primary hover:border-primary transition-all duration-500 group">
                        <i class="ri-tiktok-fill text-xl text-gray-400 group-hover:text-white transition-colors"></i>
                    </a>
                    <a href="#" class="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center hover:bg-primary hover:border-primary transition-all duration-500 group">
                        <i class="ri-facebook-box-fill text-xl text-gray-400 group-hover:text-white transition-colors"></i>
                    </a>
                </div>
            </div>

            <!-- Links Grid -->
            <div class="lg:w-3/5 grid grid-cols-2 md:grid-cols-3 gap-12 sm:gap-16">
                <!-- Navigation -->
                <div>
                    <h4 class="text-white font-black text-xs uppercase tracking-[0.2em] mb-8 flex items-center gap-3">
                        <span class="w-2 h-2 bg-primary rounded-full"></span> Navigasi
                    </h4>
                    <ul class="space-y-5 text-gray-400 font-bold text-sm">
                                                    <li><a href="index.html" class="hover:text-primary transition-colors hover:translate-x-1 inline-block transition-transform duration-300">Home</a></li>
                                                    <li><a href="about.html" class="hover:text-primary transition-colors hover:translate-x-1 inline-block transition-transform duration-300">About Us</a></li>
                                                    <li><a href="layanan.html" class="hover:text-primary transition-colors hover:translate-x-1 inline-block transition-transform duration-300">Service</a></li>
                                                    <li><a href="galeri.html" class="hover:text-primary transition-colors hover:translate-x-1 inline-block transition-transform duration-300">Gallery</a></li>
                                                    <li><a href="kontak.html" class="hover:text-primary transition-colors hover:translate-x-1 inline-block transition-transform duration-300">Contact</a></li>
                                            </ul>
                </div>
                <!-- Support -->
                <div>
                    <h4 class="text-white font-black text-xs uppercase tracking-[0.2em] mb-8 flex items-center gap-3">
                        <span class="w-2 h-2 bg-accent rounded-full"></span> Jangkauan
                    </h4>
                    <ul class="space-y-4 text-gray-400 font-bold text-[11px] uppercase tracking-wider">
                                                                        <li><a href="layanan.html" class="text-white/30 hover:text-accent italic">Lihat Semua Wilayah...</a></li>
                    </ul>
                </div>
                <!-- Contact (Unique Icon Style) -->
                <div class="col-span-2 md:col-span-1">
                    <h4 class="text-white font-black text-xs uppercase tracking-[0.2em] mb-8 flex items-center gap-3">
                        <span class="w-2 h-2 bg-white rounded-full"></span> Hotline
                    </h4>
                    <div class="flex flex-col gap-4">
                        <!-- WhatsApp Card -->
                        <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border border-white/5 hover:border-primary/30 transition-all duration-300 group cursor-pointer">
                            <div class="w-11 h-11 bg-primary/10 rounded-xl flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-all duration-500 shadow-sm">
                                <i class="ri-whatsapp-line text-xl"></i>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-0.5">Call & WA</div>
                                <div class="text-white font-black text-sm tracking-wide leading-none">0812-4666-8749</div>
                            </div>
                        </div>
                        <!-- Response Card -->
                        <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border border-white/5 hover:border-accent/30 transition-all duration-300 group cursor-pointer">
                            <div class="w-11 h-11 bg-accent/10 rounded-xl flex items-center justify-center text-accent group-hover:bg-accent group-hover:text-white transition-all duration-500 shadow-sm">
                                <i class="ri-timer-flash-fill text-xl"></i>
                            </div>
                            <div>
                                <div class="text-white font-black text-sm tracking-wide leading-none">Fast Respon</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Bar -->
        <div class="pt-12 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="flex flex-col md:flex-row items-center gap-6 text-center md:text-left">
                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-[0.2em]">© 2026 RooterIn Indonesia • Developed by Ardy Albanna</p>
                <div class="hidden md:block w-1.5 h-1.5 bg-white/10 rounded-full"></div>
                <div class="flex gap-6 text-[10px] text-gray-500 font-black uppercase tracking-[0.2em]">
                    <a href="#" class="hover:text-white transition-colors">Privacy</a>
                    <a href="#" class="hover:text-white transition-colors">Terms</a>
                    <a href="#" class="hover:text-white transition-colors">Cookies</a>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <span class="text-[10px] text-gray-500 font-black uppercase tracking-[0.2em]">Proudly Made In</span>
                <span class="text-white font-black tracking-tighter text-sm flex items-center gap-1">
                    INDONESIA 
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-red-600"></span>
                    </span>
                </span>
            </div>
        </div>
    </div>
</footer>
        
        <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3 animate-fade-in-up" x-data="{ showTop: false }" @scroll.window="showTop = (window.pageYOffset > 300)">
    
    <!-- Back to Top Button -->
    <button @click="window.scrollTo({top: 0, behavior: 'smooth'})" 
            x-show="showTop"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-10 scale-75"
            x-transition:enter-end="opacity-100 translate-y-0 scale-100"
            x-transition:leave="transition ease-in duration-300"
            x-transition:leave-start="opacity-100 translate-y-0 scale-100"
            x-transition:leave-end="opacity-0 translate-y-10 scale-75"
            class="w-12 h-12 bg-white text-secondary hover:bg-secondary hover:text-white rounded-full shadow-lg border border-gray-100 flex items-center justify-center transition-all duration-300 group">
        <i class="ri-arrow-up-line text-xl group-hover:-translate-y-1 transition-transform"></i>
    </button>

    <div class="flex items-center gap-3">
        <div class="hidden md:block bg-white text-secondary py-2 px-4 rounded-full shadow-lg border border-gray-100 font-medium text-sm animate-bounce-soft">
            Konsultasi Gratis, Kak 👋
        </div>
        <a href="https://wa.me/6281234567890?text=Halo%20Kak%2C%20mau%20tanya%20jasa%20pipa%20dong" 
           onclick="trackWhatsAppClick('sticky')"
           target="_blank"
           class="flex items-center justify-center w-14 h-14 bg-[#25D366] hover:bg-[#20b85a] text-white rounded-full shadow-[0_4px_20px_rgba(37,211,102,0.4)] transition-all duration-300 transform hover:scale-110 group relative">
            <span class="absolute inline-flex h-full w-full rounded-full bg-[#25D366] opacity-30 animate-ping group-hover:opacity-50"></span>
            <i class="ri-whatsapp-line text-3xl relative z-10"></i>
        </a>
    </div>
</div>
    </div>
    
    <div x-data="accessibilityMenu()" 
     class="fixed bottom-6 left-6 z-[100] transition-all duration-500"
     id="accessibility-container">
    
    <!-- Toggle Button -->
    <button @click="open = !open" 
            class="w-14 h-14 rounded-full bg-secondary text-white shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all group relative overflow-hidden">
        <div class="absolute inset-0 bg-primary opacity-0 group-hover:opacity-20 transition-opacity"></div>
        <i class="ri-accessibility-fill text-2xl transition-transform duration-500" :class="open ? 'rotate-180' : ''"></i>
    </button>

    <!-- Accessibility Panel -->
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-10 scale-90"
         x-transition:enter-end="opacity-100 translate-y-0 scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0 scale-100"
         x-transition:leave-end="opacity-0 translate-y-10 scale-90"
         class="fixed sm:absolute bottom-24 sm:bottom-20 left-4 right-4 sm:left-0 sm:right-auto sm:w-[400px] max-h-[70vh] sm:max-h-[80vh] bg-white/95 backdrop-blur-xl rounded-[2.5rem] shadow-[0_20px_60px_rgba(0,0,0,0.2)] flex flex-col overflow-hidden border border-gray-100"
         @click.away="open = false">
        
        <!-- Header -->
        <div class="bg-secondary p-8 flex items-center justify-between">
            <div class="flex items-center gap-4 text-white">
                <i class="ri-accessibility-fill text-lg text-primary"></i>
                <h3 class="font-black text-xs uppercase tracking-[0.3em]">Aksesibilitas Pro</h3>
            </div>
            <button @click="open = false" class="text-white/40 hover:text-white transition-colors">
                <i class="ri-close-line text-2xl"></i>
            </button>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-8 custom-scrollbar space-y-12">
            
            <!-- Panduan Pengguna Link -->
            <a href="panduan-aksesibilitas" class="relative overflow-hidden flex items-center justify-between p-5 bg-gradient-to-br from-secondary via-secondary to-[#1a2533] rounded-2xl shadow-lg group hover:scale-[1.02] transition-all duration-300 border border-white/10">
                <!-- Decorative BG -->
                <div class="absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2"></div>
                
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center backdrop-blur-sm border border-white/5">
                        <i class="ri-book-open-line text-white text-lg"></i>
                    </div>
                    <div>
                        <h4 class="text-white font-black text-[10px] uppercase tracking-widest mb-0.5">Panduan Pengguna</h4>
                        <p class="text-white/50 text-[9px] font-medium">Cara menggunakan fitur ini</p>
                    </div>
                </div>
                
                <div class="relative z-10 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg group-hover:bg-white group-hover:text-secondary transition-colors">
                    <i class="ri-arrow-right-line group-hover:translate-x-0.5 transition-transform"></i>
                </div>
            </a>

            <!-- Profil Cerdas (Presets) -->
            <div>
                <h4 class="text-gray-400 font-black text-[9px] uppercase tracking-[0.3em] mb-6">Profil Cerdas (Presets)</h4>
                <div class="grid grid-cols-2 gap-3">
                    <template x-for="preset in presets" :key="preset.id">
                        <button @click="togglePreset(preset.id)"
                                :class="settings.preset === preset.id ? 'bg-secondary text-white shadow-xl rotate-1' : 'bg-white border-gray-100 text-gray-400 hover:border-gray-200'"
                                class="flex flex-col items-center p-6 rounded-2xl border transition-all duration-300 group">
                            <i :class="preset.icon" class="text-xl mb-3 transition-transform group-hover:scale-110"></i>
                            <span class="text-[9px] font-black uppercase tracking-widest text-center" x-text="preset.label"></span>
                        </button>
                    </template>
                </div>
            </div>

            <!-- Ukuran Teks (4 Levels) -->
            <div>
                <h4 class="text-gray-400 font-black text-[9px] uppercase tracking-[0.3em] mb-6">Ukuran Teks</h4>
                <div class="grid grid-cols-4 gap-2 bg-stone-50 p-2 rounded-2xl border border-gray-100">
                    <button @click="setTextSize(0)" 
                            :class="settings.textSize === 0 ? 'bg-white text-secondary shadow-md font-bold' : 'text-gray-400 hover:bg-white/50'"
                            class="py-3 rounded-xl text-[10px] uppercase tracking-widest transition-all">
                        Small
                    </button>
                    <button @click="setTextSize(1)" 
                            :class="settings.textSize === 1 ? 'bg-white text-secondary shadow-md font-bold' : 'text-gray-400 hover:bg-white/50'"
                            class="py-3 rounded-xl text-[10px] uppercase tracking-widest transition-all">
                        Med
                    </button>
                    <button @click="setTextSize(2)" 
                            :class="settings.textSize === 2 ? 'bg-white text-secondary shadow-md font-bold' : 'text-gray-400 hover:bg-white/50'"
                            class="py-3 rounded-xl text-[10px] uppercase tracking-widest transition-all">
                        Semi
                    </button>
                    <button @click="setTextSize(3)" 
                            :class="settings.textSize === 3 ? 'bg-white text-secondary shadow-md font-bold' : 'text-gray-400 hover:bg-white/50'"
                            class="py-3 rounded-xl text-[10px] uppercase tracking-widest transition-all">
                        Large
                    </button>
                </div>
            </div>

            <!-- Penyesuaian Konten -->
            <div>
                <h4 class="text-gray-400 font-black text-[9px] uppercase tracking-[0.3em] mb-6">Penyesuaian Konten</h4>
                <div class="grid grid-cols-3 gap-3">
                    <template x-for="opt in contentOpts" :key="opt.id">
                        <button @click="toggleOption(opt.id)"
                                :class="settings[opt.id] ? 'bg-secondary text-white border-secondary' : 'bg-white border-gray-100 text-gray-400'"
                                class="flex flex-col items-center justify-center p-4 h-24 rounded-2xl border transition-all">
                            <i x-show="opt.icon" :class="opt.icon" class="text-xl mb-2"></i>
                            <span x-show="opt.text" class="text-lg font-black leading-none mb-1" x-text="opt.text"></span>
                            <span class="text-[8px] font-black uppercase tracking-widest" x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>

            <!-- Warna & Tampilan -->
            <div>
                <h4 class="text-gray-400 font-black text-[9px] uppercase tracking-[0.3em] mb-6">Warna & Tampilan</h4>
                <div class="grid grid-cols-2 gap-3">
                    <template x-for="opt in visualOpts" :key="opt.id">
                        <button @click="toggleOption(opt.id)"
                                :class="settings[opt.id] ? 'bg-secondary text-white border-secondary' : 'bg-white border-gray-100 text-gray-400'"
                                class="flex flex-col items-center p-6 rounded-2xl border transition-all">
                            <i :class="opt.icon" class="text-xl mb-3"></i>
                            <span class="text-[9px] font-black uppercase tracking-widest" x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>

            <!-- Alat Bantu -->
            <div>
                <h4 class="text-gray-400 font-black text-[9px] uppercase tracking-[0.3em] mb-6">Alat Bantu</h4>
                <div class="space-y-3">
                    <button @click="toggleOption('tts')"
                            :class="settings.tts ? 'bg-secondary text-white' : 'bg-white border-gray-100 text-gray-400'"
                            class="w-full flex flex-col items-center gap-2 p-4 rounded-2xl border transition-all">
                        <div class="flex items-center gap-3">
                            <i class="ri-volume-up-fill text-lg"></i>
                            <span class="text-[8px] font-black uppercase tracking-widest">Suara (TTS)</span>
                        </div>
                        <span x-show="settings.tts" class="text-[9px] text-white/80 font-medium animate-pulse">
                            (Sorot / Blok teks untuk mendengarkan)
                        </span>
                    </button>
                </div>
            </div>

            <!-- Reset Button -->
            <button @click="reset()" class="w-full py-5 bg-stone-100 rounded-2xl text-gray-500 font-black text-[10px] uppercase tracking-[0.2em] hover:bg-red-50 hover:text-red-500 transition-all flex items-center justify-center gap-3">
                <i class="ri-restart-line text-lg animate-spin-slow"></i>
                Reset Pengaturan
            </button>
        </div>
    </div>
</div>

<script>
function accessibilityMenu() {
    return {
        open: false,
        mouseY: 0,
        ttsHandler: null,
        settings: {
            preset: null,
            textSize: 0,
            spacing: false,
            links: false,
            dyslexia: false,
            cursor: false,
            grayscale: false,
            highContrast: false,
            neonMode: false,
            hideImages: false,
            stopAnim: false,
            tts: false
        },
        presets: [
            { id: 'epilepsy', label: 'Aman Epilepsi', icon: 'ri-skull-line' },
            { id: 'visual', label: 'Gangguan Visual', icon: 'ri-eye-off-line' },
            { id: 'adhd', label: 'Fokus ADHD', icon: 'ri-mind-map' },
            { id: 'senior', label: 'Lansia Friendly', icon: 'ri-parent-line' }
        ],
        contentOpts: [
            { id: 'spacing', label: 'Spasi', icon: 'ri-text-spacing' },
            { id: 'links', label: 'Links', icon: 'ri-links-line' },
            { id: 'dyslexia', label: 'Dyslexia', text: 'DF' },
            { id: 'cursor', label: 'Kursor', icon: 'ri-cursor-fill' }
        ],
        visualOpts: [
            { id: 'grayscale', label: 'Grayscale', icon: 'ri-contrast-drop-2-line' },
            { id: 'highContrast', label: 'High Contrast', icon: 'ri-contrast-line' },
            { id: 'neonMode', label: 'Neon Mode', icon: 'ri-flashlight-line' },
            { id: 'hideImages', label: 'Sembunyi Gambar', icon: 'ri-image-off-line' },
            { id: 'stopAnim', label: 'Stop Animasi', icon: 'ri-play-line' }
        ],
        init() {
            // Load settings from localStorage
            const saved = localStorage.getItem('rooter_accessibility');
            if (saved) this.settings = JSON.parse(saved);
            
            this.applyAll();

            window.addEventListener('mousemove', (e) => {
                this.mouseY = e.clientY;
            });

            // Clean up TTS when leaving page
            window.addEventListener('beforeunload', () => {
                if (window.speechSynthesis) window.speechSynthesis.cancel();
            });
        },
        togglePreset(id) {
            this.settings.preset = (this.settings.preset === id) ? null : id;
            this.applyAll();
        },
        setTextSize(level) {
            this.settings.textSize = level;
            this.applyAll();
        },
        toggleOption(id) {
            this.settings[id] = !this.settings[id];
            
            this.applyAll();

            // Audio Feedback for TTS Activation
            if (id === 'tts' && this.settings.tts) {
                this.speak('Fitur Suara aktif. Silakan sorot teks untuk mendengarkan.');
            }
        },
        applyAll() {
            const body = document.body;
            const content = document.getElementById('site-content');
            
            // Clean up previous classes
            if (content) {
                content.classList.remove('acc-grayscale', 'acc-contrast', 'acc-neon', 'acc-hide-img');
            }
            body.classList.remove('acc-epilepsy', 'acc-visual', 'acc-adhd', 'acc-senior', 
                                'acc-text-1', 'acc-text-2', 'acc-text-3', 'acc-spacing', 'acc-links', 
                                'acc-dyslexia', 'acc-cursor', 'acc-stop-anim');

            // Apply global settings (Body)
            if (this.settings.preset) body.classList.add('acc-' + this.settings.preset);
            if (this.settings.textSize > 0) body.classList.add('acc-text-' + this.settings.textSize);
            if (this.settings.spacing) body.classList.add('acc-spacing');
            if (this.settings.links) body.classList.add('acc-links');
            if (this.settings.dyslexia) body.classList.add('acc-dyslexia');
            if (this.settings.cursor) body.classList.add('acc-cursor');
            if (this.settings.stopAnim) body.classList.add('acc-stop-anim');

            // Apply visual filters (Content Wrapper Only) to avoid breaking fixed positioning
            if (content) {
                if (this.settings.grayscale) content.classList.add('acc-grayscale');
                if (this.settings.highContrast) content.classList.add('acc-contrast');
                if (this.settings.neonMode) content.classList.add('acc-neon');
                if (this.settings.hideImages) content.classList.add('acc-hide-img');
            }

            localStorage.setItem('rooter_accessibility', JSON.stringify(this.settings));
            
            // Setup TTS
            this.setupTTS();
        },
        setupTTS() {
            if (!this.settings.tts) {
                if (window.speechSynthesis) window.speechSynthesis.cancel();
                document.removeEventListener('mouseup', this.handleTTSSelection);
                document.removeEventListener('touchend', this.handleTTSSelection); // Mobile support
                return;
            }
            
            // Define TTS Handler if not exists
            if (!this.handleTTSSelection) {
                this.handleTTSSelection = () => {
                    if (!this.settings.tts) return;
                    
                    // Small delay to ensure selection is completed
                    setTimeout(() => {
                        const selection = window.getSelection();
                        const text = selection.toString().trim();
                        
                        if (text.length > 0) {
                            this.speak(text);
                        }
                    }, 200);
                };
            }

            document.addEventListener('mouseup', this.handleTTSSelection);
            document.addEventListener('touchend', this.handleTTSSelection);
        },
        speak(text) {
            if (!window.speechSynthesis) return;
            
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID'; // Bahasa Indonesia
            utterance.rate = 0.9; // Slightly slower for clarity
            window.speechSynthesis.speak(utterance);
        },
        reset() {
            this.settings = {
                preset: null,
                textSize: 0,
                spacing: false,
                links: false,
                dyslexia: false,
                cursor: false,
                grayscale: false,
                highContrast: false,
                neonMode: false,
                hideImages: false,
                stopAnim: false,
                tts: false
            };
            this.applyAll();
        }
    }
}
</script>

<style>
/* --- 1. Text & Content Adjustments --- */
body.acc-text-1 * { font-size: 102% !important; }
body.acc-text-2 * { font-size: 104% !important; }
body.acc-text-3 * { font-size: 106% !important; }
.acc-spacing { letter-spacing: 0.1em !important; word-spacing: 0.2em !important; line-height: 2 !important; }
.acc-links a { text-decoration: underline !important; color: #16a34a !important; font-weight: 800 !important; }
.acc-dyslexia * { font-family: 'OpenDyslexic', 'Comic Sans MS', 'Chalkboard SE', sans-serif !important; }
.acc-cursor { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="black" stroke="white" stroke-width="2"><path d="M7 2l12 11.2-5.8.8 3.3 5.4-2.5 1.6-3.3-5.4-3.7 3.4z"/></svg>'), auto !important; }

/* --- 2. Visual Filters (Applied to #site-content) --- */
#site-content.acc-grayscale { filter: grayscale(100%) !important; }
#site-content.acc-neon { filter: contrast(150%) brightness(120%) hue-rotate(90deg) !important; }
#site-content.acc-hide-img img, 
#site-content.acc-hide-img canvas,
#site-content.acc-hide-img video,
#site-content.acc-hide-img [style*="background-image"] { opacity: 0 !important; visibility: hidden !important; }

/* Robust High Contrast (Yellow on Black) */
#site-content.acc-contrast { background-color: #000 !important; color: #ffeb3b !important; }
#site-content.acc-contrast * { 
    background-color: #000 !important; 
    color: #ffeb3b !important; 
    border-color: #ffeb3b !important;
    box-shadow: none !important;
    text-shadow: none !important;
}
#site-content.acc-contrast img { filter: grayscale(100%) contrast(200%); }

/* --- 3. Presets Logic --- */

/* Aman Epilepsi: Desaturate & Stop Anim */
body.acc-epilepsy #site-content { filter: saturate(30%) !important; }
body.acc-epilepsy *, body.acc-stop-anim * { 
    animation: none !important; 
    transition: none !important; 
    scroll-behavior: auto !important;
}

/* Gangguan Visual: Scale & Contrast */
body.acc-visual { font-size: 1.25rem !important; }
body.acc-visual #site-content { filter: contrast(125%) !important; }

/* Fokus ADHD: Focus Highlight & Muted Colors */
body.acc-adhd #site-content { filter: saturate(80%); }
body.acc-adhd *:focus-visible, body.acc-adhd *:hover { 
    outline: 3px solid #f59e0b !important; 
    outline-offset: 2px !important;
}

/* Lansia Friendly: Larger Text & Readable Font */
body.acc-senior { font-size: 1.2rem !important; }
body.acc-senior * { font-family: 'Inter', sans-serif !important; letter-spacing: 0.05em; }

/* Custom Scrollbar */
.custom-scrollbar::-webkit-scrollbar { width: 4px; }
.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
.custom-scrollbar::-webkit-scrollbar-thumb { background: #eee; border-radius: 10px; }
</style>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => {
                        console.log('Service Worker Registered');
                        // NOTE: Auto-reload disabled to prevent interrupting AI Diagnostic modal
                        // reg.onupdatefound fires but we DON'T force reload anymore
                        reg.onupdatefound = () => {
                            const installingWorker = reg.installing;
                            installingWorker.onstatechange = () => {
                                if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New SW version available (manual refresh to apply).');
                                    // DO NOT auto-reload — would disrupt AI modal result display
                                }
                            };
                        };
                    })
                    .catch(err => console.log('Service Worker Failed', err));
            });
        }
    </script>
</body>
</html>
